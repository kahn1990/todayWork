<%- include ../modulesTools/headerLoader %>
<%- include ../modulesTools/header %>

<link type="text/css" rel="stylesheet" href="../lib/quill.snow.css"/>
<script type="text/javascript" src="../lib/quill.js"></script>
<script>
    Date.prototype.format = function (fmt) {
        var week = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', '星期日', '星期一', '星期二',
            '星期三', '星期四', '星期五', '星期六'];
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds(), //毫秒
            "DD": week[this.getDay() + 7]
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr((k == "DD") ? 2 : ("" + o[k]).length)));
        return fmt;
    };
</script>
<div class="dayReportWrapper" style="margin-top:200px;">
    <div class="container-fluid">
        <div class="col-md-12" id="day_report_content" role="tabpanel">

            <ul class="nav nav-tabs" role="tablist">
                <% _data.forEach(  function(_data_box, index_d){
                if(_data_box.children.length === 1){ %>

                <li role="presentation" class="<%= (index_d === 0) ? 'active' : null %>">
                    <a href="#<%= _data_box.id %>_<%= _data_box.children[0].id %>"
                       id="<%= _data_box.id %>_<%= _data_box.children[0].id %>-tab" role="tab" data-toggle="tab"
                       aria-controls="home" aria-expanded="false"><%= _data_box.name %></a>
                </li>
                <% } else if (_data_box.children.length > 1){ %>
                <li role="presentation" class="dropdown <%= (index_d === 0) ? 'active' : null %>">
                    <a href="#" id="myTabDrop_<%= _data_box.id %>" class="dropdown-toggle" data-toggle="dropdown"
                       aria-controls="<%= _data_box.id %>-contents" aria-expanded="false">
                        <%= _data_box.name %>
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu theDepartmentFirstLink" aria-labelledby="myTabDrop_<%= _data_box.id %>"
                        id="<%= _data_box.id %>-contents">
                        <% _data_box.children.forEach(  function(_data_box_group, index_g){ %>
                        <li class="<%= (index_g === 0) ? 'active' : null %>">
                            <a href="#<%= _data_box.id %>_<%= _data_box_group.id %>" role="tab"
                               id="<%= _data_box.id %>_<%= _data_box_group.id %>-tab" data-toggle="tab"
                               aria-controls="dropdown_<%= _data_box_group.id %>"
                               aria-expanded="<%= (index_g === 0) ? 'true' : null %>">@<%= _data_box_group.name %></a>
                        </li>
                        <% }) %>
                    </ul>
                </li>
                <% }}) %>
            </ul>
            <div class="tab-content">
                <% _data.forEach(  function(_data_box){
                    _data_box.children.forEach(  function(_data_box_group){ %>
                <div role="tabpanel" class="tab-pane fade" id="<%= _data_box.id %>_<%= _data_box_group.id %>" aria-labelledby="<%= _data_box.id %>_<%= _data_box_group.id %>-tab">
                    <span class="departmentAndGroupName"><%= _data_box_group.name %></span>
                    <div class="dataContent">
                        <ul class="dataLeftContent">
                            <li class="dataBoxRelative dateHeight">日期</li>
                            <% _data_box_group.children.forEach(  function(_data_box_user){ %>
                            <li class="dataBoxRelative"><%= _data_box_user.uname %></li>
                            <% }); %>
                        </ul>
                        <div class="dataRightContent">
                            <ul class="dateBox dateHeight">
                                <% poDataList.forEach(  function(poDataList_data){ %>
                                <li class="dataContentDate" data-time="<%= (new Date(poDataList_data)).getTime() %>"><%= poDataList_data %></li>
                                <% }); %>
                            </ul>
                            <div class="noteBox">
                                <% _data_box_group.children.forEach(  function(_data_box_user){ %>
                                <ul class="dataContentDate">
                                    <% poDataList.forEach( function(poDataList_data){
                                            _data_box_user.children.forEach(  function(_data_box_datenote){
                                        _data_box_datenote.ndate = (typeof _data_box_datenote.ndate === 'number') ? _data_box_datenote.ndate : Number(_data_box_datenote.ndate);
                                    if(poDataList_data === (new Date(_data_box_datenote.ndate)).format('yyyy-MM-dd')){%>
                                    <li class="td_content_box"
                                          id="quill_<%= _data_box_datenote.nid %>_<%= _data_box_datenote.ndate %>_<%= _data_box_datenote.gid || _data_box_group.id %>_<%= _data_box_user.uaccount %>"
                                          datenote-id="<%= _data_box_datenote.nid %>"
                                          date-time="<%= _data_box_datenote.ndate %>"
                                          user-account="<%= _data_box_user.uaccount %>"
                                          group-id="<%= _data_box_datenote.gid || _data_box_group.id %>">
                                    <%- _data_box_datenote.ncontent %>
                                </li>
                                    <% }});}); %>
                                </ul>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                </div>
                <% })}) %>
            </div>
            <script type="application/javascript">
                (function ($) {
                    $('.theDepartmentFirstLink').each(function (index, item) {
                        var _this = $(this),
                                theDepartmentTabId = _this.find('li:first-child a').attr('href');
                        $(theDepartmentTabId).addClass("active in");
                    })
                })($)
            </script>
        </div>
    </div>
<%- include ../modulesTools/footerLoader %>